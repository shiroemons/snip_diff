# SnipDiff 機能仕様書

## 概要

**SnipDiff**は、未保存テキスト同士の差分をGitHub風のUIでオフライン表示するmacOSデスクトップアプリケーションです。クリップボードの内容やテキストエディタの一時的な内容など、ファイルとして保存されていないテキストの差分を素早く確認できます。

## コア機能

### 1. テキスト差分表示

#### 1.1 入力方式
- **直接入力**: エディタに直接テキストを入力
- **クリップボード貼り付け**: 左右のエディタそれぞれにクリップボードから貼り付け可能
- **即時差分計算**: テキスト入力・変更時に自動的に差分を計算・表示

#### 1.2 表示モード
- **Side-by-Side（左右並列）**: 元のテキストと変更後のテキストを左右に並べて表示
- **Unified（統合表示）**: 1カラムで追加行・削除行を統合して表示
- **キーボードショートカット**: `⌘1` でUnified、`⌘2` でSide-by-Side

#### 1.3 Compactモード
- **目的**: 行レベルの背景色を削除し、実際に変更された文字だけを精密にハイライト
- **特徴**:
  - 文字単位の正確な差分ハイライト
  - 行全体のハイライトを抑制し、視覚的ノイズを低減
  - 変更されていない領域を自動的に折りたたみ（hideUnchangedRegions）
  - インジケータやOverview Rulerを非表示にして表示をシンプル化
- **トグル**: チェックボックスまたは `⌘3` でオン/オフ切り替え
- **詳細**: [Compactモード仕様書](03_compact-mode.md) を参照

### 2. エディタ機能

#### 2.1 シンタックスハイライト
- **サポート言語**:
  - プログラミング言語: JavaScript, TypeScript, Python, Java, C#, C++, C, Go, Rust, PHP, Ruby, Swift, Kotlin
  - マークアップ: HTML, XML, Markdown
  - データ: JSON, YAML
  - その他: CSS, SCSS, SQL, Shell, Plain Text
- **言語切り替え**: フッターのドロップダウンから選択

#### 2.2 エディタオプション
- **フォントサイズ**: 10〜36px（2px刻み）
- **空白文字の可視化**: スペース・タブを記号で表示
  - 可視化しない（デフォルト）
  - 単語境界のみ可視化
  - 選択時のみ可視化
  - 行末のみ可視化（コード品質チェックに便利）
  - すべて可視化（インデント確認に便利）
- **タブサイズ**: 2, 4, 8スペース
- **インデント方式**: スペース or タブ
- **ワードラップ**: オン/オフ切り替え可能
- **改行コード**: LF, CRLF, Auto（OS依存）を個別設定可能

#### 2.3 差分オプション
- **空白無視**: 行頭・行末の空白や連続する空白の違いを無視
- **改行コード正規化**: LFとCRLFの違いを無視（デフォルト有効）
- **差分アルゴリズム**: Advanced（高精度）

### 3. 操作機能

#### 3.1 基本操作
- **比較**: テキスト入力時に自動的に差分を計算
- **スワップ**: 左右のテキストを入れ替え（`⌘⇧K`）
- **クリア**: 両方のエディタをクリア（`⌘K`）

#### 3.2 ビューコントロール
- **パネルリサイズ**: 入力エディタと差分表示パネルの高さ調整
- **全画面表示**: 差分パネルを全画面化
- **最小化**: 差分パネルを一時的に非表示

### 4. 統計情報表示

フッターに以下の統計を表示：
- **追加行数**: `+N` 形式で緑色表示
- **削除行数**: `-N` 形式で赤色表示
- **Hunks**: 差分ブロック数（現在は固定で1）

### 5. テーマ

#### 5.1 テーマ種類
- **ライトテーマ**: 明るい背景
- **ダークテーマ**: 暗い背景
- **システムテーマ（Auto）**: macOSの外観設定に自動追従

#### 5.2 切り替え方法
- ヘッダーの太陽/月アイコンボタンから選択
- システムテーマ変更時に自動的に追従

### 6. 自動更新

#### 6.1 更新チェック
- **起動時チェック**: 設定で有効な場合、起動3秒後に自動チェック
- **定期チェック**: 12時間ごとに自動チェック
- **手動チェック**: メニューの「Check for Updates...」または設定画面から実行

#### 6.2 更新フロー
1. 更新が利用可能な場合、通知バナー表示
2. ユーザーがダウンロードを選択
3. ダウンロード進捗を表示
4. ダウンロード完了後、インストール可否を確認
5. インストール実行でアプリ再起動

#### 6.3 設定
- **自動更新チェック**: オン/オフ切り替え可能（デフォルト: オフ）
- **詳細**: [自動更新仕様書](05_auto-update.md) を参照

### 7. 設定の永続化

- **electron-store**を使用して設定を永続化
- 保存される設定項目: [設定仕様書](04_settings.md) を参照

## 非機能要件

### セキュリティ
- **オフライン動作**: ネットワーク不要で全機能が動作
- **サンドボックス**: Electronのサンドボックスモードを有効化
- **コンテキスト分離**: `contextIsolation: true` でレンダラーとメインプロセスを分離
- **ドラッグ&ドロップ防止**: セキュリティのためファイルD&Dを無効化

### パフォーマンス
- **即時差分計算**: テキスト変更時に自動計算（debounceなし）
- **自動レイアウト**: ウィンドウリサイズ時の自動調整
- **Monaco Editor**: 高性能なエディタエンジンを使用

### アクセシビリティ
- **キーボードショートカット**: 全主要機能にショートカット割り当て
- **ARIAラベル**: 適切なアクセシビリティ属性を設定
- **フォーカス管理**: タブキーによる適切なフォーカス移動
